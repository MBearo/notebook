# isEmoji

## æ­£åˆ™

```javascript
const rsDingbat = '[\\u2700-\\u27bf]'
const rsRegional = '(?:\\ud83c[\\udde6-\\uddff]){2}'
// const rsSurrPair = '[\\ud800-\\udbff][\\udc00-\\udfff]';
const rsSurrPair = '[\\ud83c-\\ud83d][\\udc00-\\udfff]'

const keycap = '[\\u0023\\u002a\\u0030-\\u0039]\\ufe0f?\\u20e3'
const miscSymbols = '[\\u2600-\\u26FF]'
const cjkLettersAndMonths = [
  '\\u3299',
  '\\u3297'
]
const cjkSymbolsAndPunctuation = [
  '\\u303d',
  '\\u3030'
]
const enclosedAlphanumerics = [
  '\\u24c2'
]
const enclosedAlphanumericSupplement = [
  '\\ud83c[\\udd70-\\udd71]',
  '\\ud83c[\\udd7e-\\udd7f]',
  '\\ud83c\\udd8e',

  '\\ud83c[\\udd91-\\udd9a]',

  '\\ud83c[\\udde6-\\uddff]'
]
const enclosedIdeographicSupplement = [
  '[\\ud83c\\ude01-\\ude02]',
  '\\ud83c\\ude1a',
  '\\ud83c\\ude2f',
  '[\\ud83c\\ude32-\\ude3a]',
  '[\\ud83c\\ude50-\\ude51]'
]
const generalPunctuation = [
  '\\u203c',
  '\\u2049'
]
const geometricShapes = [
  '[\\u25aa-\\u25ab]',
  '\\u25b6',
  '\\u25c0',
  '[\\u25fb-\\u25fe]'
]
const latin1Supplement = [
  '\\u00a9',
  '\\u00ae'
]
const letterLikeSymbols = [
  '\\u2122',
  '\\u2139'
]
const mahjongTiles = [
  '\\ud83c\\udc04'
]
const miscSymbolsAndArrows = [
  '\\u2b05',
  '\\u2b06',
  '\\u2b07',
  '\\u2b1b',
  '\\u2b1c',
  '\\u2b50',
  '\\u2b55'
]
const miscTechnical = [
  '\\u231a',
  '\\u231b',
  '\\u2328',
  '\\u23cf',
  '[\\u23e9-\\u23f3]',
  '[\\u23f8-\\u23fa]'
]
const playingCards = [
  '\\ud83c\\udccf'
]
const supplementalArrows = [
  '\\u2934',
  '\\u2935'
]
const arrows = [
  '[\\u2190-\\u21ff]'
]
const supplemental = [].concat(
  rsDingbat,
  rsRegional,
  rsSurrPair,

  keycap,
  cjkLettersAndMonths,
  cjkSymbolsAndPunctuation,
  enclosedAlphanumerics,
  enclosedAlphanumericSupplement,
  enclosedIdeographicSupplement,
  generalPunctuation,
  geometricShapes,
  latin1Supplement,
  letterLikeSymbols,
  mahjongTiles,
  miscSymbols,
  miscSymbolsAndArrows,
  miscTechnical,

  playingCards,
  supplementalArrows,
  arrows
).join('|')

const rsEmoji = '(?:' + supplemental + ')'

const emojiRegex = new RegExp(rsEmoji)

```

## è¯æ˜

ä¸»è¦æ¥æºäº[è¿™ç¯‡æ–‡ç« ](https://thekevinscott.com/emojis-in-javascript/)

åŸæ–‡ä¸­æœ‰ä¸€éƒ¨åˆ†é”™è¯¯ï¼Œå¦‚ä¸‹ï¼š

```shell
Miscellaneous Symbols and Pictographs
These range from U+1F300 to U+1F5FF, with the following surrogate pairs:

toUTF16(0x1F300)
> "\uD83C\uDF00"

toUTF16(0x1F5FF)
> "\uD83D\uDDFF"
The regex for this range, from lodashâ€™s implementation, is:

[\ud800-\udbff][\udc00-\udfff]

/[\ud800-\udbff][\udc00-\udfff]/.test(String.fromCodePoint(0x1F5FF))
> true

/[\ud800-\udbff][\udc00-\udfff]/.test(String.fromCodePoint(0x1F300))
> true
```

ä»–çš„è¿™éƒ¨åˆ†æ­£åˆ™æ¥è‡ª lodashï¼Œæˆ‘æµ‹äº†ä¸€ä¸‹æœ‰é—®é¢˜

```javascript
/[\ud800-\udbff][\udc00-\udfff]/.test("ğ ®·") // true
```

è¿™ä¸ªæ±‰å­—è¢«åˆ¤æ–­ä¸ºemojiï¼Œæœ‰ç‚¹é—®é¢˜ã€‚

å»åˆ°[æ–‡ç« ä¸­æåˆ°çš„emojiåˆ†ç±»](https://en.wikipedia.org/wiki/Miscellaneous_Symbols_and_Pictographs)ï¼Œemoji å¯¹åº”çš„ Unicode å€¼ä» `U+1F300` - `U+1F5FF`ï¼Œéœ€è¦è½¬æ¢ä¸ºå¯¹åº”çš„ UTF-16

å…ˆåˆ¤æ–­ Unicode å€¼æ˜¯åœ¨åŸºæœ¬å¹³é¢ï¼ˆBMPï¼‰è¿˜æ˜¯è¾…åŠ©å¹³é¢ï¼ˆSMPï¼‰

å¦‚æœ Unicode å€¼åœ¨ `U+0000` - `U+FFFF` ä¹‹é—´ï¼Œå°±æ˜¯åœ¨åŸºæœ¬å¹³é¢ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è½¬æ¢

```shell
U+597D = 0x597D
```

å¦‚æœ Unicode å€¼åœ¨ `U+10000` - `U+1FFFF` ä¹‹é—´ï¼Œå°±æ˜¯åœ¨è¾…åŠ©å¹³é¢ï¼Œé‚£ä¹ˆæ ¹æ® Unicode 3.0 ç»™çš„è½¬ç å…¬å¼å¯ä»¥è®¡ç®—

```javascript
H = Math.floor(( c - 0x10000 ) / 0x400 ) + 0xD800

L = (c - 0x10000) % 0x400 + 0xDC00
```

æˆ‘ä»¬æ‹¿ğŸŒ€ä¸¾ä¸ªä¾‹å­ï¼š

é¦–å…ˆæˆ‘ä»¬å¯ä»¥æ ¹æ® wiki é‡Œçš„è¡¨æ ¼å‘ç°ğŸŒ€å¯¹åº”çš„ Unicode å€¼ä¸º `U+1F300`ï¼Œæ ¹æ®ä¸Šæ–‡ï¼Œä»–åœ¨è¾…åŠ©å¹³é¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®¡ç®—

```javascript
H = Math.floor(( 0x1F300 - 0x10000 ) / 0x400 )+ 0xD800 // 55356 é»˜è®¤äºŒè¿›åˆ¶æ˜¾ç¤º

L = (0x1F300 - 0x10000) % 0x400 + 0xDC00 // 57088

H.toString(16) // "d83c"

L.toString(16) // "df00"

'\ud83c\udf00' // ğŸŒ€
```

è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¡ç®— Unicode å€¼å¯¹åº”çš„ UTF-16 çš„ç¼–ç 

ä¸ºäº†æ‰¾åˆ° Miscellaneous Symbols and Pictographs ä¸­emojiçš„æ­£ç¡®èŒƒå›´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ wiki table ä¸­çš„æ‰€æœ‰ emoji è½¬æ¢ä¸€ä¸‹

```javascript
// unicode çš„èŒƒå›´ä¸º 0x1f5f9 - 0x1f300
// 0x1f300 - 0x1f5f9 = 761
const H = []
const L = []
for(var i= 0;i < 761; i++){
    H.push(Math.floor((0x1f300 +i - 0x10000 ) / 0x400)+0xD800)
    L.push((0x1f300+i - 0x10000) % 0x400 + 0xDC00)
}
const HArray=Array.from(new Set(H)).sort((a,b)=>a-b)
const LArray=Array.from(new Set(L)).sort((a,b)=>a-b)

const HStart=HArray[0].toString(16) // "d83c"
const HEnd=HArray[HArray.length-1].toString(16) // "d83d"
const LStart=LArray[0].toString(16) // "dc00"
const LEnd=LArray[LArray.length-1].toString(16) // "dfff"

// H ä½å–å€¼èŒƒå›´ä¸º d83c - d83d
// L ä½å–å€¼èŒƒå›´ä¸º dc00 - dfff

// æ‰€ä»¥æ­£åˆ™åº”è¯¥ä¸º
/[\ud83c-\ud83d][\udc00-\udfff]/.test('ğ ®·') // false
```

## å…¶ä»–æ–¹æ³•

```javascript
// ä»¥å•ä¸ªå­—æˆ–è€…emojiä¸ºä¸€ä¸ªå…ƒç´ åˆ‡å‰²å­—ç¬¦ä¸²
// æ”¹è‡ª https://juejin.im/post/5dd5e92c51882578f675abc7
function stringSplit(str) {
  var data = strToUnicode(str);
  var reg = new RegExp(/\\u\{[A-z0-9]+\}(\\u\{200d\}{1}\\u\{[A-z0-9]+\})*/, 'g');// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²æ¯ä¸ªå®Œæ•´å­—ç¬¦
  var datas = reg[Symbol.match](data);
  var result = [];
  var length = 0;
  for (var i in datas) {
    var value = datas[i].split("\\u").slice(1);
    value = value.map(str => {
      var value = str.replace(/\\u/g, "").replace(/{/g, "").replace(/}/g, "");
      length += getByteByHex(value);
      return parseInt(value, 16);
    });
   result.push(String.fromCodePoint(...value))
  }
  return result;
}

/* é€šè¿‡æ–‡å­—äºŒè¿›åˆ¶å¾—åˆ°æ–‡å­—å­—èŠ‚æ•° */
function getByteByBinary(binaryCode) {
   /**
    * äºŒè¿›åˆ¶ Binary system,es6è¡¨ç¤ºæ—¶ä»¥0bå¼€å¤´
    * å…«è¿›åˆ¶ Octal number system,es5è¡¨ç¤ºæ—¶ä»¥0å¼€å¤´,es6è¡¨ç¤ºæ—¶ä»¥0oå¼€å¤´
    * åè¿›åˆ¶ Decimal system
    * åå…­è¿›åˆ¶ Hexadecimal,es5ã€es6è¡¨ç¤ºæ—¶ä»¥0xå¼€å¤´
    */
    var byteLengthDatas = [0, 1, 2, 3, 4];
    var len = byteLengthDatas[Math.ceil(binaryCode.length / 8)];
    return len;
  }

/* é€šè¿‡æ–‡å­—åå…­è¿›åˆ¶å¾—åˆ°æ–‡å­—å­—èŠ‚æ•° */
function getByteByHex(hexCode) {
  return getByteByBinary(parseInt(hexCode, 16).toString(2));
}

/* å­—ç¬¦ä¸²è½¬Unicodeåå…­è¿›åˆ¶ */
function strToUnicode (str) {
  var result = ''
  for (var i = 0; i < str.length; i++) {
    var code = str.codePointAt(i).toString(16)
    result += `\\u\{${code}\}`
    if (code.length > 4) {
      i++ // ç”±äºstr.lengthä¹Ÿåªèƒ½å¤„ç†ä¸¤ä¸ªå­—èŠ‚çš„æ–‡å­—ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦åˆ¤æ–­å¦‚æœcodePointAtå¾—åˆ°å¤šå­—ç¬¦å°±å¾—è·³è¿‡ä¸€æ¬¡å¾ªç¯
    }
  }
  return result
}

// emojiè½¬ä¸º10è¿›åˆ¶
'ğŸ˜€'.codePointAt()

// emojiè½¬ä¸º16è¿›åˆ¶
'ğŸ˜€'.codePointAt(0).toString(16) // "1f600"
```

## å¼•ç”¨

[Emoji è¯†åˆ«ä¸è¿‡æ»¤](https://www.jianshu.com/p/42fd6f84c27a)

[Emojis in Javascript](https://thekevinscott.com/emojis-in-javascript/)

[emoji-tree](https://github.com/thekevinscott/emoji-tree/blob/master/lib/emojiRegex.js)

[wikipedia -> Emoji](https://en.wikipedia.org/wiki/Miscellaneous_Symbols_and_Pictographs)

[unicode-emoji-13.0](https://unicode.org/Public/emoji/13.0/emoji-test.txt)

[Unicode and Javascript](https://2ality.com/2013/09/javascript-unicode.html) è¿™æ–‡ç« é‡Œçš„ toUTF16 æ–¹æ³•æœ‰ç‚¹é—®é¢˜

[Unicodeä¸JavaScriptè¯¦è§£](https://www.ruanyifeng.com/blog/2014/12/unicode.html)

[JavaScript çš„å†…éƒ¨å­—ç¬¦ç¼–ç æ˜¯ UCS-2 è¿˜æ˜¯ UTF-16](https://segmentfault.com/a/1190000006960642)

[å­—ç¬¦ç¼–ç çš„å¥¥ç§˜utf-8, Unicode](https://blog.csdn.net/hherima/article/details/8655200)

[emoji-cheat-sheet](https://github.com/WebpageFX/emoji-cheat-sheet.com)

[ã€JavaScriptæ–‡æœ¬æˆªå–ã€‘è¯¥æ­»çš„Emojiè¡¨æƒ…](https://juejin.im/post/5dd5e92c51882578f675abc7)

[Unicode in JavaScript](https://flaviocopes.com/javascript-unicode/#emojis)